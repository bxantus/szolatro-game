"use strict";(()=>{var u=class{constructor(e){this.compute=e}};function l(n){return new u(n)}var m=class{constructor(e,t){this.bindings=[];this.objRef=new WeakRef(e),t&&this.bindings.push(t)}refresh(){let e=this.objRef.deref();if(e)for(let t of this.bindings)A(e,t)}};function A(n,e){let t=e.calc.compute();typeof e.prop=="object"?e.prop.get()!=t&&e.prop.set(t):n[e.prop]!=t&&(n[e.prop]=t)}var T=class n{constructor(e){this.isVisible=!0;this.isConnected=!1;this.children=[];e&&(this.bindings=new m(e))}get visible(){return this.isVisible}updateVisible(){let e=this.isVisible;if(this.visibleBinding?this.isVisible=this.visibleBinding.calc.compute():this.isVisible=!0,e!=this.isVisible){if(this.isVisible)this.connected();else for(let t of n.nodesOfTree(this))t.isVisible=!1,t.disconnected();if(this.visibleBinding){let t=this.bindings?.objRef.deref();if(!t)return;this.isVisible?P(t):C(t)}}}addListener(e){this.isConnected&&e.onConnected(),this.listeners?this.listeners.push(e):this.listeners=[e]}addChild(e){return this.children.push(e),this.isVisible?e.isVisible&&e.connected():e.isVisible=!1,e}removeChild(e){let t=this.children.indexOf(e);this.children.splice(t,1),e.removeSubTree()}removeSubTree(){this.disconnected();for(let e of this.children)e.removeSubTree();this.children.splice(0,1/0)}static*nodesOfTree(e){yield e;for(let t of e.children)yield*n.nodesOfTree(t)}connected(){if(!this.isConnected&&(this.isConnected=!0,!!this.listeners))for(let e of this.listeners)e.onConnected()}disconnected(){if(this.isConnected&&(this.isConnected=!1,!!this.listeners))for(let e of this.listeners)e.onDisconnected()}},x=class{constructor(){this.nodesByElement=new WeakMap;this.root=new T}getForElement(e){return this.nodesByElement.get(e)}getOrCreateForElement(e){let t=this.nodesByElement.get(e);return t||(t=new T(e),this.nodesByElement.set(e,t),t)}},f=new x,M=n=>f.getOrCreateForElement(n);function S(n){if(n.updateVisible(),!n.visible)return 0;let e=0;n.bindings&&(n.bindings.refresh(),e++);for(let t of n.children)e+=S(t);return e}function B(n){requestAnimationFrame(B),U(n);let e=E.length;for(let t=0;t<e;++t)E[t]();E.splice(0,e),g.running=!0;for(let t of p)t.enabled&&t.update();g.running=!1,g.dirty&&(p=p.filter(t=>t.enabled),g.dirty=!1),L.numLightBoundObjects=S(f.root)}var E=[],g={running:!1,dirty:!1},p=[];function I(n){for(;n;n=n.parentElement){let e=f.getForElement(n);if(e)return e}return f.root}var D=(n,e)=>{let t=f.getForElement(n);t&&(e=e.addChild(t));for(let i=0;i<n.children.length;++i){let r=n.children[i];r instanceof HTMLElement&&D(r,e)}},O=(n,e)=>{let t=f.getForElement(n);if(t)e.removeChild(t);else for(let i=0;i<n.children.length;++i){let r=n.children[i];r instanceof HTMLElement&&O(r,e)}},X=(n,e)=>{for(let i of n)i.addedNodes.forEach(r=>{r.nodeType==1&&r instanceof HTMLElement&&D(r,I(i.target))}),i.removedNodes.forEach(r=>{r.nodeType==1&&r instanceof HTMLElement&&O(r,I(i.target))})},j=new MutationObserver(X),N;function R(){N==null&&(N=requestAnimationFrame(B),window.addEventListener("load",n=>{j.observe(document.body,{subtree:!0,childList:!0})}))}var L={timestamp:0,numLightBoundObjects:0,numRecurringUpdates:p.length,fps:60},b,w=0,G=200;function U(n){if(L.timestamp=n,L.numRecurringUpdates=p.length,b===void 0)b=n;else{let e=n-b;w++,e>=G&&(L.fps=Math.round(w*1e3/e),w=0,b=n)}}function o(n,e,...t){let i=document.createElement(n),r=i;if(e?.id&&(r.id=e.id),e?.class&&W(r,"className",e.class),e?.text&&W(r,"textContent",e.text),e?.onClick&&(r.onclick=a=>e.onClick.call(i,a)),e?.visible!=null)if(e.visible instanceof u){let a=M(r);a.visibleBinding={prop:"visible",calc:e.visible},a.updateVisible()}else e.visible||C();if(t)for(let a of t)a&&(typeof a=="string"||a instanceof HTMLElement?r.append(a):r.append(a.element));return i}function d(n,...e){return o("div",n,...e)}function c(n,...e){return o("span",n,...e)}function W(n,e,t){t instanceof u?(n[e]=t.compute(),M(n).bindings.bindings.push({prop:e,calc:t})):n[e]=t}function C(...n){for(let e of n)e.style.display="none"}function P(...n){for(let e of n)e.style.display=""}R();function k(n){let t=o("dialog",{class:"dialog"},n(()=>{t?.close(),t?.remove()}));return t.setAttribute("closedby","none"),document.body.append(t),t.showModal(),t}var s=class{constructor(e,t){this.letter=e;this.score=t}},v=class n{constructor(){this.letters=[]}get available(){return this.letters.length}add(e,t=1){this.letters.push(e);for(let i=1;i<t;++i)this.letters.push({letter:e.letter,score:e.score})}pickLetters(e){let t=[];for(let i=0;i<e&&this.letters.length>0;++i){let r=Math.floor(Math.random()*this.letters.length);t.push(this.letters[r]),this.letters.splice(r,1)}return t}static makeHungarianLetterBag(){let e=new n;return e.add(new s("A",1),6),e.add(new s("E",1),6),e.add(new s("K",1),6),e.add(new s("T",1),5),e.add(new s("\xC1",1),4),e.add(new s("L",1),4),e.add(new s("N",1),4),e.add(new s("R",1),4),e.add(new s("I",1),3),e.add(new s("M",1),3),e.add(new s("O",1),3),e.add(new s("S",1),3),e.add(new s("B",2),3),e.add(new s("D",2),3),e.add(new s("G",2),3),e.add(new s("\xD3",2),3),e.add(new s("\xC9",3),3),e.add(new s("H",3),2),e.add(new s("SZ",3),2),e.add(new s("V",3),2),e.add(new s("F",4),2),e.add(new s("GY",4),2),e.add(new s("J",4),2),e.add(new s("\xD6",4),2),e.add(new s("P",4),2),e.add(new s("U",4),2),e.add(new s("\xDC",4),2),e.add(new s("Z",4),2),e.add(new s("C",5),1),e.add(new s("\xCD",5),1),e.add(new s("NY",5),1),e.add(new s("CS",7),1),e.add(new s("\u0150",7),1),e.add(new s("\xDA",7),1),e.add(new s("\u0170",7),1),e.add(new s("LY",8),1),e.add(new s("ZS",8),1),e.add(new s("TY",10),1),e}};var H=class{deleteLetter(){this.onRemove?.(),this.onRemove=void 0,this.letter=void 0}},y=class{constructor(e){this.available=e;this.parts=[];this.cursor=0;this.parts=Array.from({length:e},()=>new H)}typeLetter(e,t){let i=this.parts[this.cursor];i.letter=e,i.onRemove=t,this.cursor++}backspace(){if(this.cursor==0)return;this.parts[--this.cursor].deleteLetter()}clear(){for(let e of this.parts)e.deleteLetter();this.cursor=0}get valid(){if(this.cursor==0)return!1;let e=this.parts.findIndex(t=>t.letter==null);return e==-1||e>=this.cursor}get word(){let e="";for(let t=0;t<this.cursor;++t){let i=this.parts[t];if(!i.letter)return"";e+=i.letter.letter}return e}};var h=class{constructor(){this.letterBag=v.makeHungarianLetterBag();this.NUM_LETTERS=16;this.INITIAL_GOAL=40;this.INITIAL_MOVES=8;this.INITIAL_REWARD=5;this.letters=[];this.usedLetters=[];this.typedWord=new y(10);this.score=0;this.goal=this.INITIAL_GOAL;this.coins=0;this.reward=this.INITIAL_REWARD;this.round=1;this.moves=this.INITIAL_MOVES;this.remainingMoves=this.moves;this.pickInitialLetters()}pickInitialLetters(){this.letters=this.letterBag.pickLetters(this.NUM_LETTERS).map(e=>({letter:e,available:!0}))}nextRound(){this.round++,this.typedWord.clear(),this.score=0,this.goal=Math.round(this.goal*1.5),this.round%3==0&&(this.moves+=2),this.remainingMoves=this.moves,this.replenishLetterBag(),this.putDisplayedLettersBackToBag(),this.pickInitialLetters()}get totalLetters(){return this.letterBag.available+this.usedLetters.length+this.letters.length}replenishLetterBag(){for(let e of this.usedLetters)this.letterBag.add(e);this.usedLetters=[]}putDisplayedLettersBackToBag(){for(let e of this.letters)e.letter&&(this.letterBag.add(e.letter),e.letter=void 0)}letter(e){let t=()=>this.letters[e].letter?.letter??" ",i=()=>this.letters[e].letter?.score.toString()??"",r=()=>this.letters[e].available?"":"disabled";return d({class:l(()=>`letter ${r()}`),onClick:()=>this.letterClicked(e)},o("button",{class:"btn btn-lg btn-primary fill w-100 h-100",text:l(t)}),c({class:"letter-score p-1",text:l(i)}))}letterClicked(e){let t=this.letters[e];!t.available||!t.letter||(t.available=!1,this.typedWord.typeLetter(t.letter,()=>{t.available=!0}))}submitWord(){if(console.log("Submitting word: ",this.typedWord.word),words.includes(this.typedWord.word)&&this.typedWord.valid){console.log("Correct word!");for(let t of this.letters)t.available||(this.usedLetters.push(t.letter),this.letterBag.available==0&&this.replenishLetterBag(),t.letter=this.letterBag.pickLetters(1)[0],t.available=!0);let e=this.typedWord.parts.reduce((t,i)=>t+(i.letter?.score??0),0);this.score+=e,this.typedWord.clear(),this.remainingMoves--,this.score>=this.goal&&this.roundSummary()}else console.warn("Nope")}shuffleLetters(){for(let e=this.letters.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[this.letters[e],this.letters[t]]=[this.letters[t],this.letters[e]]}}dropLetters(){if(this.typedWord.cursor!=0){for(let e of this.letters)e.available||(this.usedLetters.push(e.letter),e.letter=this.letterBag.pickLetters(1)[0],e.available=!0);this.typedWord.clear(),this.remainingMoves--}}roundSummary(){let e=this.remainingMoves+this.reward;this.coins+=e,k(t=>d({class:"d-flex flex-column"},o("h2",{text:"Siker \u{1F973}!",class:"align-self-center"}),o("p",{text:`${game.remainingMoves} l\xE9p\xE9s maradt = ${game.remainingMoves}\u{1FA99}`}),o("p",{text:`+ ${game.reward}\u{1FA99}`}),o("p",{class:"mt-2",text:`\xD6sszesen: ${e} \u{1FA99}`}),o("button",{class:"btn btn-primary mt-2 align-self-end",text:"Tov\xE1bb",onClick:()=>{t(),this.showShopDialog()}})))}showShopDialog(){k(e=>d({class:"d-flex flex-column"},o("h2",{text:"Bolt \u{1F3EA}",class:"align-self-center"}),d({class:"mt-2"},"Itt lesznek a boltban el\xE9rhet\u0151 fejleszt\xE9sek."),o("button",{class:"btn btn-primary mt-2 align-self-end",text:"Tov\xE1bb",onClick:()=>{e(),this.nextRound()}})))}};function F(){globalThis.game=new h,V(globalThis.game)}function V(n){document.body.replaceChildren(d({class:"main m-3"},d({class:"h2 text-center",text:"SZ\xD3RAK\xD3z\xE1s"}),d({class:"mt-4 mb-2 d-flex justify-content-between"},c({class:"goal",text:l(()=>`\u{1F3C6} ${n.score} / ${n.goal}`)}),c({text:l(()=>`\u{1F579}\uFE0F ${n.round}. k\xF6r`)}),c({text:l(()=>`\u{1F4DD} ${n.remainingMoves} l\xE9p\xE9s`)})),$(n.typedWord),K(n),d({class:"scoreboard mt-3 justify-content-between d-flex"},c({text:l(()=>`\u{1F524} ${n.letterBag.available}/${n.totalLetters}`)}),c({class:"score",text:l(()=>`\u{1FA99} ${n.coins}`)})),d({class:"results mt-3 text-center",visible:l(()=>n.score>=n.goal)},d({class:"h2",text:"Siker \u{1F973}!"}),o("button",{class:"btn btn-primary",text:"K\xF6vetkez\u0151 k\xF6r",onClick:()=>n.nextRound()})),d({class:"results mt-3 text-center",visible:l(()=>n.remainingMoves<=0&&n.score<n.goal)},d({class:"h2",text:"\u{1F612} Majd m\xE1skor"}),o("button",{class:"btn btn-primary",text:"\xDAj j\xE1t\xE9k",onClick:()=>F()}))))}function K(n){let e=[];for(let a=0;a<n.NUM_LETTERS;++a)e.push(n.letter(a));let t=()=>n.typedWord.cursor>0?"":"disabled",i=()=>n.remainingMoves>0&&n.typedWord.valid?"":"disabled",r=a=>c({class:"material-symbols-outlined",text:a});return e.splice(4,0,o("button",{class:"btn ico btn-danger fill w-100 h-100",onClick:()=>n.typedWord.backspace()},r("backspace"))),e.splice(9,0,o("button",{class:l(()=>`btn ico btn-secondary fill w-100 h-100 ${t()}`),onClick:()=>n.dropLetters()},r("delete"))),e.splice(14,0,o("button",{class:"btn ico btn-info fill w-100 h-100",onClick:()=>n.shuffleLetters()},r("shuffle"))),e.splice(19,0,o("button",{class:l(()=>`btn ico btn-success fill w-100 h-100 ${i()}`),onClick:()=>n.submitWord()},r("check_circle"))),d({class:"letters"},...e)}function $(n){return o("div",{class:"typed-word"},...n.parts.map(e=>d({class:"letter"},o("button",{class:"btn btn-light fill w-100 h-100",text:l(()=>e.letter?.letter??"")}),c({class:"letter-score p-1",text:l(()=>e.letter?.score.toString()??"")}))))}window.onload=()=>{_(),V(game)};async function _(){globalThis.game=new h,console.log("Fetching words...");let n=await fetch("./words").then(t=>t.text()),e=n.split(`
`).map(t=>t.trim().toUpperCase());console.log("Words fetched: ",n.length," characters. Total words: ",e.length),globalThis.words=e}})();
